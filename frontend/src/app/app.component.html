<div class="os-shell">
  <div class="glass-blobs">
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
    <div class="blob blob-3"></div>
  </div>

  <div class="grain-overlay"></div>
  <div class="scanlines"></div>

  <div class="dynamic-island-wrapper">
    <div class="island-capsule animate-slide-down">
      <div class="island-content">
        <div class="island-left">
          <span class="material-icons-round status-icon">wifi</span>
          <span class="app-time">{{ currentTime }}</span>

          <div class="locale-switcher">
            <span class="locale-trigger">
              <span class="material-icons-round">language</span>
            </span>
            <div class="locale-dropdown">
              <button (click)="changeLanguage('en')" [class.active]="translate.currentLang === 'en'">EN</button>
              <button (click)="changeLanguage('te')" [class.active]="translate.currentLang === 'te'">తె</button>
              <button (click)="changeLanguage('ta')" [class.active]="translate.currentLang === 'ta'">த</button>
            </div>
          </div>
        </div>

        <div class="island-center">
          <span class="app-name"></span>
        </div>

        <div class="island-right">
          <ng-container *ngIf="authService.currentUser$ | async as user; else loginState">
            <span class="user-pill">{{ user.name }}</span>
            <div class="avatar-micro" [title]="user.role">
              {{ user.name.charAt(0) }}
            </div>
          </ng-container>

          <ng-template #loginState>
            <span class="guest-pill">Guest Mode</span>
          </ng-template>
        </div>
      </div>
    </div>
  </div>

  <main class="stage-center">
    <div class="window-container fade-scale-in">
      <router-outlet></router-outlet>
    </div>
  </main>

  <nav class="dock-wrapper animate-slide-up">
    <div class="dock-glass">

      <a routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}" class="dock-item"
        [matTooltip]="'NAV.HOME' | translate">
        <div class="icon-box gradient-blue">
          <span class="material-icons-round">home</span>
        </div>
        <div class="indicator"></div>
      </a>

      <a routerLink="/requests" routerLinkActive="active" class="dock-item" [matTooltip]="'NAV.REQUESTS' | translate">
        <div class="icon-box gradient-purple">
          <span class="material-icons-round">dashboard</span>
        </div>
        <div class="indicator"></div>
      </a>

      <ng-container *ngIf="authService.currentUser$ | async as user">
        <a *ngIf="user.role === 'Resident'" routerLink="/requests/new" routerLinkActive="active"
          class="dock-item big-action" [matTooltip]="'NAV.NEW_REQUEST' | translate">
          <div class="icon-box gradient-pink">
            <span class="material-icons-round">add</span>
          </div>
          <div class="indicator"></div>
        </a>
      </ng-container>

      <a routerLink="/profile" routerLinkActive="active" class="dock-item" [matTooltip]="'NAV.PROFILE' | translate">
        <div class="icon-box gradient-cyan">
          <span class="material-icons-round">person</span>
        </div>
        <div class="indicator"></div>
      </a>

      <div class="dock-divider"></div>

      <ng-container *ngIf="authService.currentUser$ | async; else authActions">
        <a (click)="logout()" href="javascript:void(0)" class="dock-item danger" matTooltip="Log Out">
          <div class="icon-box gray">
            <span class="material-icons-round">power_settings_new</span>
          </div>
        </a>
      </ng-container>

      <ng-template #authActions>
        <a routerLink="/login" class="dock-item" matTooltip="Login">
          <div class="icon-box gray">
            <span class="material-icons-round">login</span>
          </div>
        </a>
      </ng-template>

    </div>
  </nav>

</div>
