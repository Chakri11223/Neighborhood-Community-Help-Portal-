<div class="requests-dashboard fade-in">

  <header class="dashboard-header">
    <div class="header-content">
      <div class="text-group">
        <h1 class="page-title text-gradient">{{ 'LIST.TITLE' | translate }}</h1>
        <p class="page-subtitle">{{ 'LIST.SUBTITLE' | translate }}</p>
      </div>

      <div class="action-group">
        <button routerLink="/requests/new" *ngIf="userRole === 'Resident'" class="btn btn-primary btn-glow">
          <span class="material-icons-round">add_circle</span>
          <span>{{ 'LIST.NEW_BTN' | translate }}</span>
        </button>
      </div>
    </div>

    <div class="filter-bar glass-panel">
      <div class="search-input">
        <span class="material-icons-round">search</span>
        <input type="text" [placeholder]="'LIST.SEARCH_PLACEHOLDER' | translate" #searchInput>
      </div>

      <div class="filter-pills">
        <button class="pill" [class.active]="currentFilter === 'All'" (click)="setFilter('All')">{{ 'LIST.FILTER_ALL' |
          translate }}</button>
        <button class="pill" [class.active]="currentFilter === 'Pending'" (click)="setFilter('Pending')">{{
          'LIST.FILTER_PENDING' | translate }}</button>
        <button class="pill" [class.active]="currentFilter === 'In-progress'" (click)="setFilter('In-progress')">{{
          'LIST.FILTER_IN_PROGRESS' | translate }}</button>
        <button class="pill" [class.active]="currentFilter === 'Completed'" (click)="setFilter('Completed')">{{
          'LIST.FILTER_COMPLETED' | translate }}</button>
      </div>
    </div>
  </header>

  <div class="masonry-grid" *ngIf="!loading && requests.length > 0">
    <div class="request-card glass-panel" *ngFor="let req of requests" [style.animation-delay]="'100ms'">
      <div class="card-icon-wrapper" [ngClass]="getCategoryColor(req.category)">
        <span class="material-icons-round">{{ getCategoryIcon(req.category) }}</span>
      </div>

      <div class="card-top-actions">
        <div class="status-badge" [ngClass]="req.status.toLowerCase().replace(' ', '-')">
          <span class="dot"></span>
          {{ req.status }}
        </div>

        <button class="delete-icon-btn" *ngIf="userRole === 'Resident'" (click)="onDelete(req)" title="Delete">
          <span class="material-icons-round">delete_outline</span>
        </button>
      </div>

      <div class="card-content">
        <h3 class="card-title">{{ req.title }}</h3>
        <p class="card-desc">{{ req.description | slice:0:120 }}{{ req.description.length > 120 ? '...' : '' }}</p>

        <div class="meta-row">
          <div class="meta-item">
            <span class="material-icons-round">calendar_today</span>
            {{ req.created_at | date:'MMM d' }}
          </div>
          <div class="meta-item">
            <span class="material-icons-round">category</span>
            {{ req.category }}
          </div>
        </div>
      </div>

      <div class="card-footer">
        <div class="user-info">
          <div class="avatar-mini">{{ 'U' }}</div> 
          <span class="username">Resident</span>
        </div>
        <div class="actions-wrapper">
          <button class="action-btn" [routerLink]="['/requests', req.id]">
            <span>View</span>
            <span class="material-icons-round">arrow_forward</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="!loading && requests.length === 0" class="empty-state">
    <div class="empty-icon glass-panel">
      <span class="material-icons-round">inbox</span>
    </div>
    <h3>No Requests Found</h3>
    <p>Be the first to post something needed in the community!</p>
  </div>

  <div *ngIf="loading" class="loading-grid">
    <div class="skeleton-card" *ngFor="let i of [1,2,3,4,5,6]"></div>
  </div>

</div>

