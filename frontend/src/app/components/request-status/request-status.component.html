<div class="status-container fade-in" *ngIf="request">

    <div class="glass-card">
        <!-- Header: Title & Status -->
        <div class="header-section">
            <div class="request-meta">
                <h2>{{ request.title }}</h2>
                <div class="category-pill">
                    <mat-icon>{{ getCategoryIcon(request.category) }}</mat-icon>
                    <span>{{ request.category }}</span>
                </div>
            </div>

            <div class="status-badge-lg" [ngClass]="request.status.toLowerCase().replace(' ', '-')">
                {{ request.status }}
            </div>
        </div>

        <!-- Description -->
        <div class="description-box">
            <h3>Description</h3>
            <p>{{ request.description }}</p>
        </div>

        <!-- People Involved -->
        <div class="people-grid">
            <div class="person-card">
                <div class="avatar-placeholder">
                    <mat-icon>person</mat-icon>
                </div>
                <div class="info">
                    <span class="label">Requested By</span>
                    <span class="value">{{ request.resident_name }}</span>
                </div>
            </div>

            <div class="person-card" *ngIf="request.helper_name">
                <div class="avatar-placeholder">
                    <mat-icon>handshake</mat-icon>
                </div>
                <div class="info">
                    <span class="label">Accepted By</span>
                    <span class="value">{{ request.helper_name }}</span>
                </div>
            </div>
        </div>

        <!-- Self-Request Warning -->
        <div class="warning-box" *ngIf="isOwnRequest && userRole === 'Helper'">
            <mat-icon>warning</mat-icon>
            <span>You cannot accept your own request.</span>
        </div>

        <!-- Actions -->
        <div class="action-buttons">
            <!-- Helper Actions -->
            <button mat-raised-button color="primary" *ngIf="canAccept" (click)="onAccept()">
                Accept Request
            </button>

            <button mat-raised-button class="btn-primary"
                *ngIf="canComplete || (request.status === 'Accepted' && request.helper_id === userId)"
                (click)="onNextAction()">
                {{ nextActionLabel }}
            </button>

            <!-- Cancel/Back -->
            <button mat-stroked-button color="warn" routerLink="/requests">
                Back
            </button>
        </div>

    </div>
</div>

<div class="loading" *ngIf="loading">
    Loading...
</div>
<div class="loading" *ngIf="loading">
    Loading...
</div>